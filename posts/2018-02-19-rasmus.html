<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>enter_haken - Alternative content management system approach</title>
        <link rel="stylesheet" type="text/css" href="../css/default.css" />
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-109218061-1"></script>
        <script>
          var gaProperty = 'UA-109218061-1';
          var disableString = 'ga-disable-' + gaProperty;
       
          if (document.cookie.indexOf(disableString + '=true') > -1) {
              window[disableString] = true;
          }
 
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', gaProperty, { 'anonymize_ip' : true });
        </script>
    </head>
    <body>
        <div id="header">
            <div id="navigation">
                <a href="../">enter_haken</a>
                <a href="../projects.html">projects</a>
                <a href="../cookbook.html">cookbook</a>
                <a href="../notes.html">notes</a>
                <a href="../read.html">read</a>
                <a href="../about.html">about</a>
            </div>
        </div>

        <div id="content">
            <h1>Alternative content management system approach</h1>

<div class="info">
    
    Posted on February 19, 2018
    
        
</div>

<p>In the last months, I had to manage a bigger Wordpress instance with many plugins installed. It is a kind of mess. Plugins affecting each other. Different look and feel. Different UX. Plugins which must not be plugins, solving caching issues for example. The site <a href="http://www.cms-garden.org/">CMS Garden</a> shows several approaches.</p>
<p>I would like to think of a CMS like an application platform, let’s call it <code>rasmus</code>, where there plugins can be understood as a separate application. Accepting the challenge, I start something new.</p>
<p>At first, let’s start small and build a scaffold for the application platform. You can imagine this like a fast food restaurant.</p>
<div class="overflow"><?xml version="1.0" encoding="UTF-8" standalone="no" ?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="593pt" height="500pt" viewBox="0.00 0.00 593.00 500.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 496)">
<title>%3</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-496 589,-496 589,4 -4,4"></polygon>
<g id="clust1" class="cluster">
<title>cluster_0</title>
<polygon fill="#d3d3d3" stroke="#d3d3d3" points="8,-301 8,-484 199,-484 199,-301 8,-301"></polygon>
<text text-anchor="middle" x="103.5" y="-468.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">internet</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_1</title>
<polygon fill="#d3d3d3" stroke="#d3d3d3" points="211,-91 211,-462 572,-462 572,-91 211,-91"></polygon>
<text text-anchor="middle" x="391.5" y="-446.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">counter</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_2</title>
<polygon fill="#ffffff" stroke="#ffffff" points="219,-354 219,-431 564,-431 564,-354 219,-354"></polygon>
<text text-anchor="middle" x="391.5" y="-415.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">core</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_3</title>
<polygon fill="#ffffff" stroke="#ffffff" points="329.5,-99 329.5,-176 411.5,-176 411.5,-99 329.5,-99"></polygon>
<text text-anchor="middle" x="370.5" y="-160.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">cms</text>
</g>
<g id="clust5" class="cluster">
<title>cluster_4</title>
<polygon fill="#ffffff" stroke="#ffffff" points="317,-184 317,-261 424,-261 424,-184 317,-184"></polygon>
<text text-anchor="middle" x="370.5" y="-245.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">lms</text>
</g>
<g id="clust6" class="cluster">
<title>cluster_5</title>
<polygon fill="#ffffff" stroke="#ffffff" points="317,-269 317,-346 424,-346 424,-269 317,-269"></polygon>
<text text-anchor="middle" x="370.5" y="-330.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">forum</text>
</g>
<g id="clust7" class="cluster">
<title>cluster_6</title>
<polygon fill="#d3d3d3" stroke="#d3d3d3" points="444,-8 444,-83 577,-83 577,-8 444,-8"></polygon>
<text text-anchor="middle" x="510.5" y="-15.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">behind the counter</text>
</g>
<!-- client1 -->
<g id="node1" class="node">
<title>client1</title>
<path fill="#ffffff" stroke="#ffffff" d="M79,-453C79,-453 28,-453 28,-453 22,-453 16,-447 16,-441 16,-441 16,-429 16,-429 16,-423 22,-417 28,-417 28,-417 79,-417 79,-417 85,-417 91,-423 91,-429 91,-429 91,-441 91,-441 91,-447 85,-453 79,-453"></path>
<text text-anchor="middle" x="53.5" y="-431.3" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">web client</text>
</g>
<!-- web -->
<g id="node2" class="node">
<title>web</title>
<path fill="#ffffff" stroke="#ffffff" d="M179,-400C179,-400 139,-400 139,-400 133,-400 127,-394 127,-388 127,-388 127,-374 127,-374 127,-368 133,-362 139,-362 139,-362 179,-362 179,-362 185,-362 191,-368 191,-374 191,-374 191,-388 191,-388 191,-394 185,-400 179,-400"></path>
<text text-anchor="middle" x="159" y="-384.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">web</text>
<text text-anchor="middle" x="159" y="-369.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">backend</text>
</g>
<!-- client1&#45;&gt;web -->
<g id="edge1" class="edge">
<title>client1-&gt;web</title>
<path fill="none" stroke="#000000" d="M88.9235,-416.8686C98.1776,-412.1318 108.2321,-406.9855 117.7599,-402.1087"></path>
<polygon fill="#000000" stroke="#000000" points="119.3832,-405.2097 126.6902,-397.5377 116.1938,-398.9785 119.3832,-405.2097"></polygon>
</g>
<!-- transfer -->
<g id="node5" class="node">
<title>transfer</title>
<path fill="#d3d3d3" stroke="#d3d3d3" d="M277,-400C277,-400 239,-400 239,-400 233,-400 227,-394 227,-388 227,-388 227,-374 227,-374 227,-368 233,-362 239,-362 239,-362 277,-362 277,-362 283,-362 289,-368 289,-374 289,-374 289,-388 289,-388 289,-394 283,-400 277,-400"></path>
<text text-anchor="middle" x="258" y="-384.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">transfer</text>
<text text-anchor="middle" x="258" y="-369.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">table</text>
</g>
<!-- web&#45;&gt;transfer -->
<g id="edge9" class="edge">
<title>web-&gt;transfer</title>
<path fill="none" stroke="#000000" d="M191.1425,-381C199.2506,-381 208.0702,-381 216.5642,-381"></path>
<polygon fill="#000000" stroke="#000000" points="216.6939,-384.5001 226.6938,-381 216.6938,-377.5001 216.6939,-384.5001"></polygon>
</g>
<!-- client2 -->
<g id="node3" class="node">
<title>client2</title>
<path fill="#ffffff" stroke="#ffffff" d="M79,-399C79,-399 28,-399 28,-399 22,-399 16,-393 16,-387 16,-387 16,-375 16,-375 16,-369 22,-363 28,-363 28,-363 79,-363 79,-363 85,-363 91,-369 91,-375 91,-375 91,-387 91,-387 91,-393 85,-399 79,-399"></path>
<text text-anchor="middle" x="53.5" y="-377.3" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">web client</text>
</g>
<!-- client2&#45;&gt;web -->
<g id="edge2" class="edge">
<title>client2-&gt;web</title>
<path fill="none" stroke="#000000" d="M91.2899,-381C99.5287,-381 108.2982,-381 116.6993,-381"></path>
<polygon fill="#000000" stroke="#000000" points="116.7037,-384.5001 126.7037,-381 116.7036,-377.5001 116.7037,-384.5001"></polygon>
</g>
<!-- client3 -->
<g id="node4" class="node">
<title>client3</title>
<path fill="#ffffff" stroke="#ffffff" d="M79,-345C79,-345 28,-345 28,-345 22,-345 16,-339 16,-333 16,-333 16,-321 16,-321 16,-315 22,-309 28,-309 28,-309 79,-309 79,-309 85,-309 91,-315 91,-321 91,-321 91,-333 91,-333 91,-339 85,-345 79,-345"></path>
<text text-anchor="middle" x="53.5" y="-323.3" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">web client</text>
</g>
<!-- client3&#45;&gt;web -->
<g id="edge3" class="edge">
<title>client3-&gt;web</title>
<path fill="none" stroke="#000000" d="M88.9235,-345.1314C98.1776,-349.8682 108.2321,-355.0145 117.7599,-359.8913"></path>
<polygon fill="#000000" stroke="#000000" points="116.1938,-363.0215 126.6902,-364.4623 119.3832,-356.7903 116.1938,-363.0215"></polygon>
</g>
<!-- user -->
<g id="node6" class="node">
<title>user</title>
<path fill="#d3d3d3" stroke="#d3d3d3" d="M404,-400C404,-400 337,-400 337,-400 331,-400 325,-394 325,-388 325,-388 325,-374 325,-374 325,-368 331,-362 337,-362 337,-362 404,-362 404,-362 410,-362 416,-368 416,-374 416,-374 416,-388 416,-388 416,-394 410,-400 404,-400"></path>
<text text-anchor="middle" x="370.5" y="-384.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">user</text>
<text text-anchor="middle" x="370.5" y="-369.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">management</text>
</g>
<!-- transfer&#45;&gt;user -->
<g id="edge4" class="edge">
<title>transfer-&gt;user</title>
<path fill="none" stroke="#000000" d="M289.0389,-381C296.9857,-381 305.779,-381 314.5621,-381"></path>
<polygon fill="#000000" stroke="#000000" points="314.8167,-384.5001 324.8167,-381 314.8167,-377.5001 314.8167,-384.5001"></polygon>
</g>
<!-- content -->
<g id="node8" class="node">
<title>content</title>
<path fill="#d3d3d3" stroke="#d3d3d3" d="M391.5,-145C391.5,-145 349.5,-145 349.5,-145 343.5,-145 337.5,-139 337.5,-133 337.5,-133 337.5,-119 337.5,-119 337.5,-113 343.5,-107 349.5,-107 349.5,-107 391.5,-107 391.5,-107 397.5,-107 403.5,-113 403.5,-119 403.5,-119 403.5,-133 403.5,-133 403.5,-139 397.5,-145 391.5,-145"></path>
<text text-anchor="middle" x="370.5" y="-129.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">content</text>
<text text-anchor="middle" x="370.5" y="-114.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">relations</text>
</g>
<!-- transfer&#45;&gt;content -->
<g id="edge6" class="edge">
<title>transfer-&gt;content</title>
<path fill="none" stroke="#000000" d="M260.4375,-361.7455C265.8283,-324.4288 281.2346,-240.6061 317,-180 322.9054,-169.993 331.0772,-160.4818 339.2579,-152.3091"></path>
<polygon fill="#000000" stroke="#000000" points="341.887,-154.6383 346.7085,-145.2041 337.0561,-149.5724 341.887,-154.6383"></polygon>
</g>
<!-- lms -->
<g id="node9" class="node">
<title>lms</title>
<path fill="#d3d3d3" stroke="#d3d3d3" d="M404,-230C404,-230 337,-230 337,-230 331,-230 325,-224 325,-218 325,-218 325,-204 325,-204 325,-198 331,-192 337,-192 337,-192 404,-192 404,-192 410,-192 416,-198 416,-204 416,-204 416,-218 416,-218 416,-224 410,-230 404,-230"></path>
<text text-anchor="middle" x="370.5" y="-214.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">lms</text>
<text text-anchor="middle" x="370.5" y="-199.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">management</text>
</g>
<!-- transfer&#45;&gt;lms -->
<g id="edge7" class="edge">
<title>transfer-&gt;lms</title>
<path fill="none" stroke="#000000" d="M265.5374,-361.9031C275.4315,-338.0369 294.242,-296.5012 317,-265 324.0533,-255.237 332.8772,-245.5719 341.3128,-237.1757"></path>
<polygon fill="#000000" stroke="#000000" points="343.8179,-239.622 348.5716,-230.1534 338.9508,-234.5909 343.8179,-239.622"></polygon>
</g>
<!-- forum -->
<g id="node10" class="node">
<title>forum</title>
<path fill="#d3d3d3" stroke="#d3d3d3" d="M404,-315C404,-315 337,-315 337,-315 331,-315 325,-309 325,-303 325,-303 325,-289 325,-289 325,-283 331,-277 337,-277 337,-277 404,-277 404,-277 410,-277 416,-283 416,-289 416,-289 416,-303 416,-303 416,-309 410,-315 404,-315"></path>
<text text-anchor="middle" x="370.5" y="-299.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">forum</text>
<text text-anchor="middle" x="370.5" y="-284.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">management</text>
</g>
<!-- transfer&#45;&gt;forum -->
<g id="edge8" class="edge">
<title>transfer-&gt;forum</title>
<path fill="none" stroke="#000000" d="M283.2472,-361.9243C299.1696,-349.8941 319.9117,-334.2223 337.177,-321.1774"></path>
<polygon fill="#000000" stroke="#000000" points="339.4683,-323.8329 345.3371,-315.012 335.2484,-318.2478 339.4683,-323.8329"></polygon>
</g>
<!-- role -->
<g id="node7" class="node">
<title>role</title>
<path fill="#d3d3d3" stroke="#d3d3d3" d="M544,-400C544,-400 477,-400 477,-400 471,-400 465,-394 465,-388 465,-388 465,-374 465,-374 465,-368 471,-362 477,-362 477,-362 544,-362 544,-362 550,-362 556,-368 556,-374 556,-374 556,-388 556,-388 556,-394 550,-400 544,-400"></path>
<text text-anchor="middle" x="510.5" y="-384.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">role</text>
<text text-anchor="middle" x="510.5" y="-369.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">management</text>
</g>
<!-- user&#45;&gt;role -->
<g id="edge5" class="edge">
<title>user-&gt;role</title>
<path fill="none" stroke="#000000" d="M416.3412,-381C428.4277,-381 441.6095,-381 454.1789,-381"></path>
<polygon fill="#000000" stroke="#000000" points="454.5558,-384.5001 464.5558,-381 454.5557,-377.5001 454.5558,-384.5001"></polygon>
</g>
<!-- bl -->
<g id="node11" class="node">
<title>bl</title>
<path fill="#ffffff" stroke="#ffffff" d="M557,-75C557,-75 464,-75 464,-75 458,-75 452,-69 452,-63 452,-63 452,-51 452,-51 452,-45 458,-39 464,-39 464,-39 557,-39 557,-39 563,-39 569,-45 569,-51 569,-51 569,-63 569,-63 569,-69 563,-75 557,-75"></path>
<text text-anchor="middle" x="510.5" y="-53.3" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">database backend</text>
</g>
<!-- content&#45;&gt;bl -->
<g id="edge10" class="edge">
<title>content-&gt;bl</title>
<path fill="none" stroke="#000000" d="M403.678,-109.648C421.8271,-100.7031 444.5928,-89.4828 464.4395,-79.7012"></path>
<polygon fill="#000000" stroke="#000000" points="466.1969,-82.7371 473.6194,-75.1769 463.1023,-76.4583 466.1969,-82.7371"></polygon>
</g>
<!-- lms&#45;&gt;bl -->
<g id="edge11" class="edge">
<title>lms-&gt;bl</title>
<path fill="none" stroke="#000000" d="M408.2084,-191.9606C413.7881,-188.3642 419.2503,-184.3503 424,-180 454.8258,-151.7669 480.9304,-110.7322 496.1602,-83.9553"></path>
<polygon fill="#000000" stroke="#000000" points="499.2718,-85.5618 501.0836,-75.123 493.1575,-82.1535 499.2718,-85.5618"></polygon>
</g>
<!-- forum&#45;&gt;bl -->
<g id="edge12" class="edge">
<title>forum-&gt;bl</title>
<path fill="none" stroke="#000000" d="M410.4539,-276.8879C415.4181,-273.4019 420.1075,-269.4393 424,-265 471.164,-211.2113 495.0905,-128.0961 504.9076,-85.0248"></path>
<polygon fill="#000000" stroke="#000000" points="508.3331,-85.7437 507.0533,-75.2264 501.4951,-84.2462 508.3331,-85.7437"></polygon>
</g>
</g>
</svg>
</div>
<p>You put your request at the <code>counter</code> and behind the <code>counter</code> the magic happens. The worker behind the <code>counter</code> must not know how a burger is made, and how many fries must be in a fryer. He sees the current orders on a screen, and put the meals together, when the separate parts are ready. When the order is ready, the customer can be served.</p>
<!--more-->
<h1 id="architectural-overview">Architectural overview</h1>
<p>As you can see the database take a place in the middle.</p>
<p>As mentioned in the <a href="../posts/2017-08-07-database-architecture-part3.html">database architecture series</a> the <code>web backend</code> can put a request in the database <code>transfer</code> table. This is the only table, which can be accessed by the <code>web backend</code>. After a request is processed, the result is put back into the <code>transfer</code> entity. The database sends a <a href="https://www.postgresql.org/docs/current/static/sql-notify.html">notification</a> to the <code>web backend</code>, which can pull the response from the database. This represents a very thin interface to database. This approach leads to less security issues, because more database related functions are hidden from the <code>web backend</code>.</p>
<h1 id="the-database">The database</h1>
<p>Every application’s heart is it’s database. <code>rasmus</code> is no exception. An <code>rasmus</code> application has it’s own schema within the database. The schemes look as following.</p>
<h2 id="the-core">The core</h2>
<p>The different <code>rasmus</code> applications share a <code>core</code>. Here you can find functions, used across all applications, like user and role management.</p>
<p>First start with a simple user / role management approach.</p>
<pre><code>CREATE TABLE user_account(
    id UUID NOT NULL PRIMARY KEY DEFAULT gen_random_uuid(),
    first_name VARCHAR(254),
    last_name VARCHAR(254),
    email_address VARCHAR(254),
    password VARCHAR(254),
    login VARCHAR(254),
    signature VARCHAR(254)
);</code></pre>
<p>For the time being, we store the <code>password</code> with the user. This field can be moved later on, when different authorization methods will be introduced.</p>
<p>Starting with a simple role definition,</p>
<pre><code>CREATE TYPE role_level AS ENUM ('admin','user','guest');

CREATE TABLE role(
    id UUID NOT NULL PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR(254) NOT NULL,
    description VARCHAR(254),
    role_level role_level NOT NULL DEFAULT 'guest'
);</code></pre>
<p><code>user</code>s can have several roles.</p>
<pre><code>CREATE TABLE user_in_role(
    id_user_account UUID NOT NULL REFERENCES user_account(id),
    id_role UUID NOT NULL REFERENCES role(id),
    PRIMARY KEY(id_user_account, id_role)
);</code></pre>
<p>Every part of an <code>rasmus</code> application can be associated with a <code>privilege</code></p>
<pre><code>CREATE TABLE privilege(
    id UUID NOT NULL PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR(80),
    description VARCHAR(254)
);</code></pre>
<p>Each <code>privilege</code> can be assigned to a <code>role</code>.</p>
<pre><code>CREATE TABLE role_privilege(
    id_role UUID NOT NULL REFERENCES role(id),
    id_privilege UUID NOT NULL REFERENCES privilege(id),
    PRIMARY KEY (id_role, id_privilege)
);</code></pre>
<p>These are the minimal relations for user and role management storage.</p>
<h2 id="transfer">transfer</h2>
<p>The <code>transfer</code> relation is located in the <code>core</code> schema. It uses the following state definitions.</p>
<pre><code>CREATE TYPE transfer_status as ENUM (
    'pending',
    'processing',
    'succeeded',
    'succeeded_with_warning',
    'error'
);</code></pre>
<p>This is not carved into stone. It will fit the first requirements to a stateful exchange between the <code>web backend</code> and the database.</p>
<p>The <code>transfer</code> relation itself looks like</p>
<pre><code>CREATE TABLE transfer(
	id UUID NOT NULL PRIMARY KEY DEFAULT gen_random_uuid(),
    status transfer_status NOT NULL DEFAULT 'pending',
    request JSONB NOT NULL,
    result JSONB
);</code></pre>
<p>Per default, every request is a <code>pending</code> request. A <code>transfer</code> entity must have at least a request body.</p>
<p>At this point conventions have to be made. A request must contain</p>
<ul>
<li>a <code>schema</code> field</li>
<li>the name of the <code>entity</code></li>
<li>the actual <code>payload</code></li>
<li>and the <code>action</code> to perform.</li>
</ul>
<p>After a request is inserted into <code>transfer</code>,</p>
<pre><code>CREATE FUNCTION transfer_trigger() RETURNS TRIGGER AS $$
BEGIN 
    PERFORM pg_notify(NEW.request-&gt;&gt;'schema',NEW.id); 
    RETURN NEW;
END
$$ LANGUAGE plpgsql;

CREATE TRIGGER transfer_before_trigger BEFORE INSERT ON transfer
    FOR EACH ROW EXECUTE PROCEDURE transfer_trigger();</code></pre>
<p>a notification is send to the <code>database backend</code>. Pattern matching is used to find the right addressee for the request. A closer look has to be made, to decide, which operation must be done inside the database, to prevent multiple round trips.</p>
<div class="overflow"><?xml version="1.0" encoding="UTF-8" standalone="no" ?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="276pt" height="46pt" viewBox="0.00 0.00 276.00 46.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 42)">
<title>%3</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-42 272,-42 272,4 -4,4"></polygon>
<!-- web -->
<g id="node1" class="node">
<title>web</title>
<path fill="#d3d3d3" stroke="#d3d3d3" d="M52,-38C52,-38 12,-38 12,-38 6,-38 0,-32 0,-26 0,-26 0,-12 0,-12 0,-6 6,0 12,0 12,0 52,0 52,0 58,0 64,-6 64,-12 64,-12 64,-26 64,-26 64,-32 58,-38 52,-38"></path>
<text text-anchor="middle" x="32" y="-22.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">web</text>
<text text-anchor="middle" x="32" y="-7.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">backend</text>
</g>
<!-- database -->
<g id="node2" class="node">
<title>database</title>
<path fill="#d3d3d3" stroke="#d3d3d3" d="M154,-37C154,-37 112,-37 112,-37 106,-37 100,-31 100,-25 100,-25 100,-13 100,-13 100,-7 106,-1 112,-1 112,-1 154,-1 154,-1 160,-1 166,-7 166,-13 166,-13 166,-25 166,-25 166,-31 160,-37 154,-37"></path>
<text text-anchor="middle" x="133" y="-15.3" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">database</text>
</g>
<!-- web&#45;&gt;database -->
<g id="edge1" class="edge">
<title>web-&gt;database</title>
<path fill="none" stroke="#000000" d="M64.2347,-12.6588C72.2792,-12.2832 81.0383,-12.1664 89.5273,-12.3084"></path>
<polygon fill="#000000" stroke="#000000" points="89.5822,-15.8115 99.6817,-12.61 89.7901,-8.8146 89.5822,-15.8115"></polygon>
</g>
<!-- database&#45;&gt;web -->
<g id="edge4" class="edge">
<title>database-&gt;web</title>
<path fill="none" stroke="#000000" d="M99.6817,-25.39C91.5753,-25.7425 82.7983,-25.8361 74.3355,-25.671"></path>
<polygon fill="#000000" stroke="#000000" points="74.3436,-22.1695 64.2347,-25.3412 74.1152,-29.1657 74.3436,-22.1695"></polygon>
</g>
<!-- bl -->
<g id="node3" class="node">
<title>bl</title>
<path fill="#d3d3d3" stroke="#d3d3d3" d="M256,-38C256,-38 214,-38 214,-38 208,-38 202,-32 202,-26 202,-26 202,-12 202,-12 202,-6 208,0 214,0 214,0 256,0 256,0 262,0 268,-6 268,-12 268,-12 268,-26 268,-26 268,-32 262,-38 256,-38"></path>
<text text-anchor="middle" x="235" y="-22.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">database</text>
<text text-anchor="middle" x="235" y="-7.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">backend</text>
</g>
<!-- database&#45;&gt;bl -->
<g id="edge2" class="edge">
<title>database-&gt;bl</title>
<path fill="none" stroke="#000000" d="M166.1165,-12.6333C174.2222,-12.2719 183.018,-12.1661 191.5279,-12.3158"></path>
<polygon fill="#000000" stroke="#000000" points="191.5988,-15.8195 201.7006,-12.6251 191.8117,-8.8227 191.5988,-15.8195"></polygon>
</g>
<!-- bl&#45;&gt;database -->
<g id="edge3" class="edge">
<title>bl-&gt;database</title>
<path fill="none" stroke="#000000" d="M201.7006,-25.3749C193.5846,-25.7324 184.7858,-25.8344 176.2803,-25.6808"></path>
<polygon fill="#000000" stroke="#000000" points="176.2198,-22.1773 166.1165,-25.3667 176.0036,-29.174 176.2198,-22.1773"></polygon>
</g>
</g>
</svg>
</div>
<p>As said before, the business logic is completely separated from the <code>web backend</code>.</p>
<h2 id="cms">cms</h2>
<p>A cms starts with an <code>article</code>.</p>
<pre><code>CREATE TABLE article(
    id UUID NOT NULL PRIMARY KEY DEFAULT gen_random_uuid(),
    id_author UUID NOT NULL REFERENCES core.user_account(id),
    title VARCHAR(254),
    raw text,
    html text,
    is_visible boolean NOT NULL DEFAULT FALSE,
    is_draft boolean NOT NULL DEFAULT TRUE
);</code></pre>
<p>The <code>author</code> lives in the <code>core</code> namespace, and can be used inside the <code>cms</code> schema. The <code>raw</code> text is markdown based, the <code>html</code> is the generated result. A new <code>article</code> is per default invisible and in draft mode.</p>
<p>Before uploading <code>attachment</code>s to the database, the <code>file_type</code> has to be set.</p>
<pre><code>CREATE TYPE file_type AS ENUM (
    'binary',
    'jpeg',
    'png',
    'mp3',
    'mp4',
    'mkv'
);

CREATE TABLE attachment(
    id UUID NOT NULL PRIMARY KEY DEFAULT gen_random_uuid(),
    raw bytea NOT NULL,
    file_type file_type NOT NULL DEFAULT 'binary'
);</code></pre>
<p>As for now, the binary content is stored within the database.</p>
<p>Every <code>article</code> can have multiple attachments.</p>
<pre><code>CREATE TABLE article_attachment(
    id_article UUID NOT NULL REFERENCES article(id),
    id_attachment UUID NOT NULL REFERENCES attachment(id),
    PRIMARY KEY(id_article, id_attachment)
);</code></pre>
<p>The <code>attachment</code>s can be addressed within the <code>article</code>s markdown content.</p>
<p>The <code>cms</code> provides a tree of <code>category</code>s.</p>
<pre><code>CREATE TABLE category(
    id UUID NOT NULL PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR(254) NOT NULL,
    description VARCHAR(512),
    icon VARCHAR(1), -- font awesome
    is_active BOOLEAN NOT NULL DEFAULT false,
    is_visible BOOLEAN NOT NULL DEFAULT false,
    LNUM INTEGER NOT NULL,
    RNUM INTEGER NOT NULL
);</code></pre>
<p>The tree is described as a <a href="https://en.wikipedia.org/wiki/Nested_set_model">nested set</a>.</p>
<p>An <code>article</code> can be assigned to multiple <code>categories</code>.</p>
<pre><code>CREATE TABLE article_in_category(
    id_article UUID NOT NULL REFERENCES article(id),
    id_category UUID NOT NULL REFERENCES category(id),
    PRIMARY KEY(id_article, id_category)
);</code></pre>
<h1 id="backend">backend</h1>
<p>Having set up the database, it comes for choosing the technology for the backend. There are several possibilities choosing the ‘right’ backend technology.</p>
<p>This will be covered with the next article.</p>
<p>Fell free to browse through the <a href="https://github.com/enter-haken/rasmus">sources</a>.</p>

        </div>
        <div id="footer"> 
            created by Jan Frederik Hake | 
            <a href="https://enter-haken.github.io/atom.xml">atom feed</a> | 
            generated by <a href="http://jaspervdj.be/hakyll">Hakyll</a> | 
            <a href="https://github.com/enter-haken/blog">blog source</a> |
            the source code on this site is covered by a <a href="../license.html">MIT license</a> | 
            <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons Lizenzvertrag" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" /></a>
        </div>
    </body>
</html>
