<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>enter_haken - Alternative content management system approach</title>
        <link rel="stylesheet" type="text/css" href="../css/default.css" />
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-109218061-1"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'UA-109218061-1', { 'anonymize_ip' : true });
        </script>
    </head>
    <body>
        <div id="header">
            <div id="navigation">
                <a href="../">enter_haken</a>
                <a href="../projects.html">projects</a>
                <a href="../cookbook.html">cookbook</a>
                <a href="../notes.html">notes</a>
                <a href="../read.html">read</a>
                <a href="../about.html">about</a>
            </div>
        </div>

        <div id="content">
            <h1>Alternative content management system approach</h1>

<div class="info">
    
    Posted on February 19, 2018
    
        
</div>

<p>In the last months, I had to manage a bigger Wordpress instance with many plugins installed. It is a kind of mess. Plugins affecting each other. Different look and feel. Different UX. Plugins which must not be plugins, solving caching issues for example. The site <a href="http://www.cms-garden.org/">CMS Garden</a> shows several approaches.</p>
<p>I would like to think of a CMS like an application platform, let’s call it <code>rasmus</code>, where there plugins can be understood as a separate application. Accepting the challenge, I start something new.</p>
<p>At first, let’s start small and build a scaffold for the application platform. You can imagine this like a fast food restaurant.</p>
<div class="overflow"><?xml version="1.0" encoding="UTF-8" standalone="no" ?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="642pt" height="500pt" viewBox="0.00 0.00 642.00 500.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 496)">
<title>%3</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-496 638,-496 638,4 -4,4"></polygon>
<g id="clust1" class="cluster">
<title>cluster_0</title>
<polygon fill="#d3d3d3" stroke="#d3d3d3" points="8,-301 8,-484 214,-484 214,-301 8,-301"></polygon>
<text text-anchor="middle" x="111" y="-468.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">internet</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_1</title>
<polygon fill="#d3d3d3" stroke="#d3d3d3" points="226,-91 226,-462 616.5,-462 616.5,-91 226,-91"></polygon>
<text text-anchor="middle" x="421.25" y="-446.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">counter</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_2</title>
<polygon fill="#ffffff" stroke="#ffffff" points="234,-354 234,-431 608.5,-431 608.5,-354 234,-354"></polygon>
<text text-anchor="middle" x="421.25" y="-415.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">core</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_3</title>
<polygon fill="#ffffff" stroke="#ffffff" points="350.5,-99 350.5,-176 437.5,-176 437.5,-99 350.5,-99"></polygon>
<text text-anchor="middle" x="394" y="-160.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">cms</text>
</g>
<g id="clust5" class="cluster">
<title>cluster_4</title>
<polygon fill="#ffffff" stroke="#ffffff" points="335,-184 335,-261 453,-261 453,-184 335,-184"></polygon>
<text text-anchor="middle" x="394" y="-245.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">lms</text>
</g>
<g id="clust6" class="cluster">
<title>cluster_5</title>
<polygon fill="#ffffff" stroke="#ffffff" points="335,-269 335,-346 453,-346 453,-269 335,-269"></polygon>
<text text-anchor="middle" x="394" y="-330.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">forum</text>
</g>
<g id="clust7" class="cluster">
<title>cluster_6</title>
<polygon fill="#d3d3d3" stroke="#d3d3d3" points="473,-8 473,-83 626,-83 626,-8 473,-8"></polygon>
<text text-anchor="middle" x="549.5" y="-15.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">behind the counter</text>
</g>
<!-- client1 -->
<g id="node1" class="node">
<title>client1</title>
<path fill="#ffffff" stroke="#ffffff" d="M85,-453C85,-453 28,-453 28,-453 22,-453 16,-447 16,-441 16,-441 16,-429 16,-429 16,-423 22,-417 28,-417 28,-417 85,-417 85,-417 91,-417 97,-423 97,-429 97,-429 97,-441 97,-441 97,-447 91,-453 85,-453"></path>
<text text-anchor="middle" x="56.5" y="-431.3" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">web client</text>
</g>
<!-- web -->
<g id="node2" class="node">
<title>web</title>
<path fill="#ffffff" stroke="#ffffff" d="M194,-400C194,-400 145,-400 145,-400 139,-400 133,-394 133,-388 133,-388 133,-374 133,-374 133,-368 139,-362 145,-362 145,-362 194,-362 194,-362 200,-362 206,-368 206,-374 206,-374 206,-388 206,-388 206,-394 200,-400 194,-400"></path>
<text text-anchor="middle" x="169.5" y="-384.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">web</text>
<text text-anchor="middle" x="169.5" y="-369.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">backend</text>
</g>
<!-- client1&#45;&gt;web -->
<g id="edge1" class="edge">
<title>client1-&gt;web</title>
<path fill="none" stroke="#000000" d="M94.4417,-416.8686C103.8679,-412.364 114.0693,-407.489 123.8235,-402.8277"></path>
<polygon fill="#000000" stroke="#000000" points="125.4851,-405.9129 132.9987,-398.4431 122.4668,-399.597 125.4851,-405.9129"></polygon>
</g>
<!-- transfer -->
<g id="node5" class="node">
<title>transfer</title>
<path fill="#d3d3d3" stroke="#d3d3d3" d="M295,-400C295,-400 254,-400 254,-400 248,-400 242,-394 242,-388 242,-388 242,-374 242,-374 242,-368 248,-362 254,-362 254,-362 295,-362 295,-362 301,-362 307,-368 307,-374 307,-374 307,-388 307,-388 307,-394 301,-400 295,-400"></path>
<text text-anchor="middle" x="274.5" y="-384.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">transfer</text>
<text text-anchor="middle" x="274.5" y="-369.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">table</text>
</g>
<!-- web&#45;&gt;transfer -->
<g id="edge9" class="edge">
<title>web-&gt;transfer</title>
<path fill="none" stroke="#000000" d="M206.2239,-381C214.4645,-381 223.2768,-381 231.7392,-381"></path>
<polygon fill="#000000" stroke="#000000" points="231.826,-384.5001 241.826,-381 231.826,-377.5001 231.826,-384.5001"></polygon>
</g>
<!-- client2 -->
<g id="node3" class="node">
<title>client2</title>
<path fill="#ffffff" stroke="#ffffff" d="M85,-399C85,-399 28,-399 28,-399 22,-399 16,-393 16,-387 16,-387 16,-375 16,-375 16,-369 22,-363 28,-363 28,-363 85,-363 85,-363 91,-363 97,-369 97,-375 97,-375 97,-387 97,-387 97,-393 91,-399 85,-399"></path>
<text text-anchor="middle" x="56.5" y="-377.3" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">web client</text>
</g>
<!-- client2&#45;&gt;web -->
<g id="edge2" class="edge">
<title>client2-&gt;web</title>
<path fill="none" stroke="#000000" d="M97.2956,-381C105.5653,-381 114.3225,-381 122.7784,-381"></path>
<polygon fill="#000000" stroke="#000000" points="122.8902,-384.5001 132.8902,-381 122.8901,-377.5001 122.8902,-384.5001"></polygon>
</g>
<!-- client3 -->
<g id="node4" class="node">
<title>client3</title>
<path fill="#ffffff" stroke="#ffffff" d="M85,-345C85,-345 28,-345 28,-345 22,-345 16,-339 16,-333 16,-333 16,-321 16,-321 16,-315 22,-309 28,-309 28,-309 85,-309 85,-309 91,-309 97,-315 97,-321 97,-321 97,-333 97,-333 97,-339 91,-345 85,-345"></path>
<text text-anchor="middle" x="56.5" y="-323.3" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">web client</text>
</g>
<!-- client3&#45;&gt;web -->
<g id="edge3" class="edge">
<title>client3-&gt;web</title>
<path fill="none" stroke="#000000" d="M94.4417,-345.1314C103.8679,-349.636 114.0693,-354.511 123.8235,-359.1723"></path>
<polygon fill="#000000" stroke="#000000" points="122.4668,-362.403 132.9987,-363.5569 125.4851,-356.0871 122.4668,-362.403"></polygon>
</g>
<!-- user -->
<g id="node6" class="node">
<title>user</title>
<path fill="#d3d3d3" stroke="#d3d3d3" d="M433,-400C433,-400 355,-400 355,-400 349,-400 343,-394 343,-388 343,-388 343,-374 343,-374 343,-368 349,-362 355,-362 355,-362 433,-362 433,-362 439,-362 445,-368 445,-374 445,-374 445,-388 445,-388 445,-394 439,-400 433,-400"></path>
<text text-anchor="middle" x="394" y="-384.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">user</text>
<text text-anchor="middle" x="394" y="-369.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">management</text>
</g>
<!-- transfer&#45;&gt;user -->
<g id="edge4" class="edge">
<title>transfer-&gt;user</title>
<path fill="none" stroke="#000000" d="M307.1539,-381C315.1874,-381 324.0499,-381 332.9509,-381"></path>
<polygon fill="#000000" stroke="#000000" points="332.9747,-384.5001 342.9746,-381 332.9746,-377.5001 332.9747,-384.5001"></polygon>
</g>
<!-- content -->
<g id="node8" class="node">
<title>content</title>
<path fill="#d3d3d3" stroke="#d3d3d3" d="M417.5,-145C417.5,-145 370.5,-145 370.5,-145 364.5,-145 358.5,-139 358.5,-133 358.5,-133 358.5,-119 358.5,-119 358.5,-113 364.5,-107 370.5,-107 370.5,-107 417.5,-107 417.5,-107 423.5,-107 429.5,-113 429.5,-119 429.5,-119 429.5,-133 429.5,-133 429.5,-139 423.5,-145 417.5,-145"></path>
<text text-anchor="middle" x="394" y="-129.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">content</text>
<text text-anchor="middle" x="394" y="-114.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">relations</text>
</g>
<!-- transfer&#45;&gt;content -->
<g id="edge6" class="edge">
<title>transfer-&gt;content</title>
<path fill="none" stroke="#000000" d="M276.8084,-361.8753C282.0371,-324.4259 297.3867,-239.862 335,-180 341.5795,-169.5286 350.7221,-159.8074 359.8479,-151.5817"></path>
<polygon fill="#000000" stroke="#000000" points="362.154,-154.2147 367.4531,-145.0402 357.5893,-148.9078 362.154,-154.2147"></polygon>
</g>
<!-- lms -->
<g id="node9" class="node">
<title>lms</title>
<path fill="#d3d3d3" stroke="#d3d3d3" d="M433,-230C433,-230 355,-230 355,-230 349,-230 343,-224 343,-218 343,-218 343,-204 343,-204 343,-198 349,-192 355,-192 355,-192 433,-192 433,-192 439,-192 445,-198 445,-204 445,-204 445,-218 445,-218 445,-224 439,-230 433,-230"></path>
<text text-anchor="middle" x="394" y="-214.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">lms</text>
<text text-anchor="middle" x="394" y="-199.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">management</text>
</g>
<!-- transfer&#45;&gt;lms -->
<g id="edge7" class="edge">
<title>transfer-&gt;lms</title>
<path fill="none" stroke="#000000" d="M282.0782,-361.7341C292.0682,-337.6934 311.1964,-295.9778 335,-265 342.7335,-254.9357 352.4662,-245.1741 361.7846,-236.782"></path>
<polygon fill="#000000" stroke="#000000" points="364.2313,-239.2921 369.4616,-230.0783 359.6271,-234.0194 364.2313,-239.2921"></polygon>
</g>
<!-- forum -->
<g id="node10" class="node">
<title>forum</title>
<path fill="#d3d3d3" stroke="#d3d3d3" d="M433,-315C433,-315 355,-315 355,-315 349,-315 343,-309 343,-303 343,-303 343,-289 343,-289 343,-283 349,-277 355,-277 355,-277 433,-277 433,-277 439,-277 445,-283 445,-289 445,-289 445,-303 445,-303 445,-309 439,-315 433,-315"></path>
<text text-anchor="middle" x="394" y="-299.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">forum</text>
<text text-anchor="middle" x="394" y="-284.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">management</text>
</g>
<!-- transfer&#45;&gt;forum -->
<g id="edge8" class="edge">
<title>transfer-&gt;forum</title>
<path fill="none" stroke="#000000" d="M301.3181,-361.9243C318.385,-349.7847 340.665,-333.9371 359.1028,-320.8223"></path>
<polygon fill="#000000" stroke="#000000" points="361.1512,-323.6604 367.2714,-315.012 357.0938,-317.9562 361.1512,-323.6604"></polygon>
</g>
<!-- role -->
<g id="node7" class="node">
<title>role</title>
<path fill="#d3d3d3" stroke="#d3d3d3" d="M588.5,-400C588.5,-400 510.5,-400 510.5,-400 504.5,-400 498.5,-394 498.5,-388 498.5,-388 498.5,-374 498.5,-374 498.5,-368 504.5,-362 510.5,-362 510.5,-362 588.5,-362 588.5,-362 594.5,-362 600.5,-368 600.5,-374 600.5,-374 600.5,-388 600.5,-388 600.5,-394 594.5,-400 588.5,-400"></path>
<text text-anchor="middle" x="549.5" y="-384.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">role</text>
<text text-anchor="middle" x="549.5" y="-369.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">management</text>
</g>
<!-- user&#45;&gt;role -->
<g id="edge5" class="edge">
<title>user-&gt;role</title>
<path fill="none" stroke="#000000" d="M445.3475,-381C459.0864,-381 474.0734,-381 488.2873,-381"></path>
<polygon fill="#000000" stroke="#000000" points="488.4717,-384.5001 498.4716,-381 488.4716,-377.5001 488.4717,-384.5001"></polygon>
</g>
<!-- bl -->
<g id="node11" class="node">
<title>bl</title>
<path fill="#ffffff" stroke="#ffffff" d="M606,-75C606,-75 493,-75 493,-75 487,-75 481,-69 481,-63 481,-63 481,-51 481,-51 481,-45 487,-39 493,-39 493,-39 606,-39 606,-39 612,-39 618,-45 618,-51 618,-51 618,-63 618,-63 618,-69 612,-75 606,-75"></path>
<text text-anchor="middle" x="549.5" y="-53.3" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">database backend</text>
</g>
<!-- content&#45;&gt;bl -->
<g id="edge10" class="edge">
<title>content-&gt;bl</title>
<path fill="none" stroke="#000000" d="M429.6748,-110.17C450.4013,-100.9731 476.8364,-89.243 499.6009,-79.1417"></path>
<polygon fill="#000000" stroke="#000000" points="501.0558,-82.3253 508.7767,-75.0701 498.2166,-75.9269 501.0558,-82.3253"></polygon>
</g>
<!-- lms&#45;&gt;bl -->
<g id="edge11" class="edge">
<title>lms-&gt;bl</title>
<path fill="none" stroke="#000000" d="M435.7253,-191.9443C441.794,-188.3723 447.7552,-184.37 453,-180 486.5347,-152.0588 516.0189,-110.6823 533.3076,-83.7776"></path>
<polygon fill="#000000" stroke="#000000" points="536.3132,-85.5729 538.6914,-75.2484 530.3939,-81.8364 536.3132,-85.5729"></polygon>
</g>
<!-- forum&#45;&gt;bl -->
<g id="edge12" class="edge">
<title>forum-&gt;bl</title>
<path fill="none" stroke="#000000" d="M438.4849,-276.8156C443.7658,-273.3737 448.772,-269.4421 453,-265 503.3286,-212.1222 531.0702,-128.27 542.7594,-84.952"></path>
<polygon fill="#000000" stroke="#000000" points="546.1909,-85.6633 545.3271,-75.1037 539.4173,-83.8972 546.1909,-85.6633"></polygon>
</g>
</g>
</svg>
</div>
<p>You put your request at the <code>counter</code> and behind the <code>counter</code> the magic happens. The worker behind the <code>counter</code> must not know how a burger is made, and how many fries must be in a fryer. He sees the current orders on a screen, and put the meals together, when the separate parts are ready. When the order is ready, the customer can be served.</p>
<!--more-->
<h1 id="architectural-overview">Architectural overview</h1>
<p>As you can see the database take a place in the middle.</p>
<p>As mentioned in the <a href="../posts/2017-08-07-database-architecture-part3.html">database architecture series</a> the <code>web backend</code> can put a request in the database <code>transfer</code> table. This is the only table, which can be accessed by the <code>web backend</code>. After a request is processed, the result is put back into the <code>transfer</code> entity. The database sends a <a href="https://www.postgresql.org/docs/current/static/sql-notify.html">notification</a> to the <code>web backend</code>, which can pull the response from the database. This represents a very thin interface to database. This approach leads to less security issues, because more database related functions are hidden from the <code>web backend</code>.</p>
<h1 id="the-database">The database</h1>
<p>Every application’s heart is it’s database. <code>rasmus</code> is no exception. An <code>rasmus</code> application has it’s own schema within the database. The schemes look as following.</p>
<h2 id="the-core">The core</h2>
<p>The different <code>rasmus</code> applications share a <code>core</code>. Here you can find functions, used across all applications, like user and role management.</p>
<p>First start with a simple user / role management approach.</p>
<pre><code>CREATE TABLE user_account(
    id UUID NOT NULL PRIMARY KEY DEFAULT gen_random_uuid(),
    first_name VARCHAR(254),
    last_name VARCHAR(254),
    email_address VARCHAR(254),
    password VARCHAR(254),
    login VARCHAR(254),
    signature VARCHAR(254)
);</code></pre>
<p>For the time being, we store the <code>password</code> with the user. This field can be moved later on, when different authorization methods will be introduced.</p>
<p>Starting with a simple role definition,</p>
<pre><code>CREATE TYPE role_level AS ENUM ('admin','user','guest');

CREATE TABLE role(
    id UUID NOT NULL PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR(254) NOT NULL,
    description VARCHAR(254),
    role_level role_level NOT NULL DEFAULT 'guest'
);</code></pre>
<p><code>user</code>s can have several roles.</p>
<pre><code>CREATE TABLE user_in_role(
    id_user_account UUID NOT NULL REFERENCES user_account(id),
    id_role UUID NOT NULL REFERENCES role(id),
    PRIMARY KEY(id_user_account, id_role)
);</code></pre>
<p>Every part of an <code>rasmus</code> application can be associated with a <code>privilege</code></p>
<pre><code>CREATE TABLE privilege(
    id UUID NOT NULL PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR(80),
    description VARCHAR(254)
);</code></pre>
<p>Each <code>privilege</code> can be assigned to a <code>role</code>.</p>
<pre><code>CREATE TABLE role_privilege(
    id_role UUID NOT NULL REFERENCES role(id),
    id_privilege UUID NOT NULL REFERENCES privilege(id),
    PRIMARY KEY (id_role, id_privilege)
);</code></pre>
<p>These are the minimal relations for user and role management storage.</p>
<h2 id="transfer">transfer</h2>
<p>The <code>transfer</code> relation is located in the <code>core</code> schema. It uses the following state definitions.</p>
<pre><code>CREATE TYPE transfer_status as ENUM (
    'pending',
    'processing',
    'succeeded',
    'succeeded_with_warning',
    'error'
);</code></pre>
<p>This is not carved into stone. It will fit the first requirements to a stateful exchange between the <code>web backend</code> and the database.</p>
<p>The <code>transfer</code> relation itself looks like</p>
<pre><code>CREATE TABLE transfer(
	id UUID NOT NULL PRIMARY KEY DEFAULT gen_random_uuid(),
    status transfer_status NOT NULL DEFAULT 'pending',
    request JSONB NOT NULL,
    result JSONB
);</code></pre>
<p>Per default, every request is a <code>pending</code> request. A <code>transfer</code> entity must have at least a request body.</p>
<p>At this point conventions have to be made. A request must contain</p>
<ul>
<li>a <code>schema</code> field</li>
<li>the name of the <code>entity</code></li>
<li>the actual <code>payload</code></li>
<li>and the <code>action</code> to perform.</li>
</ul>
<p>After a request is inserted into <code>transfer</code>,</p>
<pre><code>CREATE FUNCTION transfer_trigger() RETURNS TRIGGER AS $$
BEGIN 
    PERFORM pg_notify(NEW.request-&gt;&gt;'schema',NEW.id); 
    RETURN NEW;
END
$$ LANGUAGE plpgsql;

CREATE TRIGGER transfer_before_trigger BEFORE INSERT ON transfer
    FOR EACH ROW EXECUTE PROCEDURE transfer_trigger();</code></pre>
<p>a notification is send to the <code>database backend</code>. Pattern matching is used to find the right addressee for the request. A closer look has to be made, to decide, which operation must be done inside the database, to prevent multiple round trips.</p>
<div class="overflow"><?xml version="1.0" encoding="UTF-8" standalone="no" ?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="307pt" height="46pt" viewBox="0.00 0.00 307.00 46.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 42)">
<title>%3</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-42 303,-42 303,4 -4,4"></polygon>
<!-- web -->
<g id="node1" class="node">
<title>web</title>
<path fill="#d3d3d3" stroke="#d3d3d3" d="M61,-38C61,-38 12,-38 12,-38 6,-38 0,-32 0,-26 0,-26 0,-12 0,-12 0,-6 6,0 12,0 12,0 61,0 61,0 67,0 73,-6 73,-12 73,-12 73,-26 73,-26 73,-32 67,-38 61,-38"></path>
<text text-anchor="middle" x="36.5" y="-22.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">web</text>
<text text-anchor="middle" x="36.5" y="-7.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">backend</text>
</g>
<!-- database -->
<g id="node2" class="node">
<title>database</title>
<path fill="#d3d3d3" stroke="#d3d3d3" d="M174,-37C174,-37 121,-37 121,-37 115,-37 109,-31 109,-25 109,-25 109,-13 109,-13 109,-7 115,-1 121,-1 121,-1 174,-1 174,-1 180,-1 186,-7 186,-13 186,-13 186,-25 186,-25 186,-31 180,-37 174,-37"></path>
<text text-anchor="middle" x="147.5" y="-15.3" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">database</text>
</g>
<!-- web&#45;&gt;database -->
<g id="edge1" class="edge">
<title>web-&gt;database</title>
<path fill="none" stroke="#000000" d="M73.1532,-12.6085C81.4137,-12.2825 90.3064,-12.1788 98.9689,-12.2975"></path>
<polygon fill="#000000" stroke="#000000" points="98.8991,-15.7968 108.9806,-12.539 99.0679,-8.7988 98.8991,-15.7968"></polygon>
</g>
<!-- database&#45;&gt;web -->
<g id="edge4" class="edge">
<title>database-&gt;web</title>
<path fill="none" stroke="#000000" d="M108.9806,-25.461C100.721,-25.7505 91.9061,-25.8225 83.3704,-25.6769"></path>
<polygon fill="#000000" stroke="#000000" points="83.2471,-22.1722 73.1532,-25.3915 83.0515,-29.1695 83.2471,-22.1722"></polygon>
</g>
<!-- bl -->
<g id="node3" class="node">
<title>bl</title>
<path fill="#d3d3d3" stroke="#d3d3d3" d="M287,-38C287,-38 234,-38 234,-38 228,-38 222,-32 222,-26 222,-26 222,-12 222,-12 222,-6 228,0 234,0 234,0 287,0 287,0 293,0 299,-6 299,-12 299,-12 299,-26 299,-26 299,-32 293,-38 287,-38"></path>
<text text-anchor="middle" x="260.5" y="-22.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">database</text>
<text text-anchor="middle" x="260.5" y="-7.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">backend</text>
</g>
<!-- database&#45;&gt;bl -->
<g id="edge2" class="edge">
<title>database-&gt;bl</title>
<path fill="none" stroke="#000000" d="M186.0721,-12.5616C194.2539,-12.268 202.9953,-12.1819 211.5054,-12.3032"></path>
<polygon fill="#000000" stroke="#000000" points="211.6351,-15.8074 221.718,-12.5541 211.807,-8.8095 211.6351,-15.8074"></polygon>
</g>
<!-- bl&#45;&gt;database -->
<g id="edge3" class="edge">
<title>bl-&gt;database</title>
<path fill="none" stroke="#000000" d="M221.718,-25.4459C213.5267,-25.7359 204.7826,-25.8185 196.2765,-25.6936"></path>
<polygon fill="#000000" stroke="#000000" points="196.1565,-22.1896 186.0721,-25.4384 195.9815,-29.1874 196.1565,-22.1896"></polygon>
</g>
</g>
</svg>
</div>
<p>As said before, the business logic is completely separated from the <code>web backend</code>.</p>
<h2 id="cms">cms</h2>
<p>A cms starts with an <code>article</code>.</p>
<pre><code>CREATE TABLE article(
    id UUID NOT NULL PRIMARY KEY DEFAULT gen_random_uuid(),
    id_author UUID NOT NULL REFERENCES core.user_account(id),
    title VARCHAR(254),
    raw text,
    html text,
    is_visible boolean NOT NULL DEFAULT FALSE,
    is_draft boolean NOT NULL DEFAULT TRUE
);</code></pre>
<p>The <code>author</code> lives in the <code>core</code> namespace, and can be used inside the <code>cms</code> schema. The <code>raw</code> text is markdown based, the <code>html</code> is the generated result. A new <code>article</code> is per default invisible and in draft mode.</p>
<p>Before uploading <code>attachment</code>s to the database, the <code>file_type</code> has to be set.</p>
<pre><code>CREATE TYPE file_type AS ENUM (
    'binary',
    'jpeg',
    'png',
    'mp3',
    'mp4',
    'mkv'
);

CREATE TABLE attachment(
    id UUID NOT NULL PRIMARY KEY DEFAULT gen_random_uuid(),
    raw bytea NOT NULL,
    file_type file_type NOT NULL DEFAULT 'binary'
);</code></pre>
<p>As for now, the binary content is stored within the database.</p>
<p>Every <code>article</code> can have multiple attachments.</p>
<pre><code>CREATE TABLE article_attachment(
    id_article UUID NOT NULL REFERENCES article(id),
    id_attachment UUID NOT NULL REFERENCES attachment(id),
    PRIMARY KEY(id_article, id_attachment)
);</code></pre>
<p>The <code>attachment</code>s can be addressed within the <code>article</code>s markdown content.</p>
<p>The <code>cms</code> provides a tree of <code>category</code>s.</p>
<pre><code>CREATE TABLE category(
    id UUID NOT NULL PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR(254) NOT NULL,
    description VARCHAR(512),
    icon VARCHAR(1), -- font awesome
    is_active BOOLEAN NOT NULL DEFAULT false,
    is_visible BOOLEAN NOT NULL DEFAULT false,
    LNUM INTEGER NOT NULL,
    RNUM INTEGER NOT NULL
);</code></pre>
<p>The tree is described as a <a href="https://en.wikipedia.org/wiki/Nested_set_model">nested set</a>.</p>
<p>An <code>article</code> can be assigned to multiple <code>categories</code>.</p>
<pre><code>CREATE TABLE article_in_category(
    id_article UUID NOT NULL REFERENCES article(id),
    id_category UUID NOT NULL REFERENCES category(id),
    PRIMARY KEY(id_article, id_category)
);</code></pre>
<h1 id="backend">backend</h1>
<p>Having set up the database, it comes for choosing the technology for the backend. There are several possibilities choosing the ‘right’ backend technology.</p>
<p>This will be covered with the next article.</p>
<p>Fell free to browse through the <a href="https://github.com/enter-haken/rasmus">sources</a>.</p>

        </div>
        <div id="footer"> 
            created by Jan Frederik Hake | 
            <a href="https://enter-haken.github.io/atom.xml">atom feed</a> | 
            generated by <a href="http://jaspervdj.be/hakyll">Hakyll</a> | 
            <a href="https://github.com/enter-haken/blog">blog source</a> |
            the source code on this site is covered by a <a href="../license.html">MIT license</a> | 
            <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons Lizenzvertrag" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" /></a>
        </div>
    </body>
</html>
