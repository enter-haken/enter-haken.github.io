<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>enter_haken - Alternative content management system approach</title>
        <!--<link rel="stylesheet" type="text/css" href="/css/default.css" />-->
        <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto:300,300italic,700,700italic" />
        <link rel="stylesheet" type="text/css" href="../css/milligram.min.css" />
        <link rel="stylesheet" type="text/css" href="../css/default.css" />
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-109218061-1"></script>
        <script>
          var gaProperty = 'UA-109218061-1';
          var disableString = 'ga-disable-' + gaProperty;
       
          if (document.cookie.indexOf(disableString + '=true') > -1) {
              window[disableString] = true;
          }
 
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', gaProperty, { 'anonymize_ip' : true });
        </script>
    </head>
    <body>
        <section id="navigation">
            <a href="../">enter_haken</a>
            <a href="../projects.html">projects</a>
            <a href="../cookbook.html">cookbook</a>
            <a href="../notes.html">notes</a>
            <a href="../read.html">read</a>
            <a href="../about.html">about</a>
        </section>

        <section id="content">
            <h1>Alternative content management system approach</h1>

<div class="info">
    
    Posted on February 19, 2018
    
        
</div>

<p>In the last months, I had to manage a bigger Wordpress instance with many plugins installed. It is a kind of mess. Plugins affecting each other. Different look and feel. Different UX. Plugins which must not be plugins, solving caching issues for example. The site <a href="http://www.cms-garden.org/">CMS Garden</a> shows several approaches.</p>
<p>I would like to think of a CMS like an application platform, let’s call it <code>rasmus</code>, where there plugins can be understood as a separate application. Accepting the challenge, I start something new.</p>
<p>At first, let’s start small and build a scaffold for the application platform. You can imagine this like a fast food restaurant.</p>
<div class="overflow"><?xml version="1.0" encoding="UTF-8" standalone="no" ?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="615pt" height="500pt" viewBox="0.00 0.00 615.00 500.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 496)">
<title>%3</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-496 611,-496 611,4 -4,4"></polygon>
<g id="clust1" class="cluster">
<title>cluster_0</title>
<polygon fill="#d3d3d3" stroke="#d3d3d3" points="8,-301 8,-484 205,-484 205,-301 8,-301"></polygon>
<text text-anchor="middle" x="106.5" y="-468.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">internet</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_1</title>
<polygon fill="#d3d3d3" stroke="#d3d3d3" points="217,-91 217,-462 592,-462 592,-91 217,-91"></polygon>
<text text-anchor="middle" x="404.5" y="-446.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">counter</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_2</title>
<polygon fill="#ffffff" stroke="#ffffff" points="225,-354 225,-431 584,-431 584,-354 225,-354"></polygon>
<text text-anchor="middle" x="404.5" y="-415.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">core</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_3</title>
<polygon fill="#ffffff" stroke="#ffffff" points="337.5,-99 337.5,-176 421.5,-176 421.5,-99 337.5,-99"></polygon>
<text text-anchor="middle" x="379.5" y="-160.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">cms</text>
</g>
<g id="clust5" class="cluster">
<title>cluster_4</title>
<polygon fill="#ffffff" stroke="#ffffff" points="323,-184 323,-261 436,-261 436,-184 323,-184"></polygon>
<text text-anchor="middle" x="379.5" y="-245.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">lms</text>
</g>
<g id="clust6" class="cluster">
<title>cluster_5</title>
<polygon fill="#ffffff" stroke="#ffffff" points="323,-269 323,-346 436,-346 436,-269 323,-269"></polygon>
<text text-anchor="middle" x="379.5" y="-330.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">forum</text>
</g>
<g id="clust7" class="cluster">
<title>cluster_6</title>
<polygon fill="#d3d3d3" stroke="#d3d3d3" points="456,-8 456,-83 599,-83 599,-8 456,-8"></polygon>
<text text-anchor="middle" x="527.5" y="-15.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">behind the counter</text>
</g>
<!-- client1 -->
<g id="node1" class="node">
<title>client1</title>
<path fill="#ffffff" stroke="#ffffff" d="M81,-453C81,-453 28,-453 28,-453 22,-453 16,-447 16,-441 16,-441 16,-429 16,-429 16,-423 22,-417 28,-417 28,-417 81,-417 81,-417 87,-417 93,-423 93,-429 93,-429 93,-441 93,-441 93,-447 87,-453 81,-453"></path>
<text text-anchor="middle" x="54.5" y="-431.3" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">web client</text>
</g>
<!-- web -->
<g id="node2" class="node">
<title>web</title>
<path fill="#ffffff" stroke="#ffffff" d="M185,-400C185,-400 141,-400 141,-400 135,-400 129,-394 129,-388 129,-388 129,-374 129,-374 129,-368 135,-362 141,-362 141,-362 185,-362 185,-362 191,-362 197,-368 197,-374 197,-374 197,-388 197,-388 197,-394 191,-400 185,-400"></path>
<text text-anchor="middle" x="163" y="-384.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">web</text>
<text text-anchor="middle" x="163" y="-369.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">backend</text>
</g>
<!-- client1&#45;&gt;web -->
<g id="edge1" class="edge">
<title>client1-&gt;web</title>
<path fill="none" stroke="#000000" d="M90.9308,-416.8686C100.1681,-412.2712 110.1809,-407.2878 119.7213,-402.5396"></path>
<polygon fill="#000000" stroke="#000000" points="121.2897,-405.6686 128.6827,-398.0796 118.1707,-399.4019 121.2897,-405.6686"></polygon>
</g>
<!-- transfer -->
<g id="node5" class="node">
<title>transfer</title>
<path fill="#d3d3d3" stroke="#d3d3d3" d="M283,-400C283,-400 245,-400 245,-400 239,-400 233,-394 233,-388 233,-388 233,-374 233,-374 233,-368 239,-362 245,-362 245,-362 283,-362 283,-362 289,-362 295,-368 295,-374 295,-374 295,-388 295,-388 295,-394 289,-400 283,-400"></path>
<text text-anchor="middle" x="264" y="-384.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">transfer</text>
<text text-anchor="middle" x="264" y="-369.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">table</text>
</g>
<!-- web&#45;&gt;transfer -->
<g id="edge9" class="edge">
<title>web-&gt;transfer</title>
<path fill="none" stroke="#000000" d="M197.194,-381C205.4125,-381 214.2765,-381 222.7772,-381"></path>
<polygon fill="#000000" stroke="#000000" points="222.8984,-384.5001 232.8984,-381 222.8983,-377.5001 222.8984,-384.5001"></polygon>
</g>
<!-- client2 -->
<g id="node3" class="node">
<title>client2</title>
<path fill="#ffffff" stroke="#ffffff" d="M81,-399C81,-399 28,-399 28,-399 22,-399 16,-393 16,-387 16,-387 16,-375 16,-375 16,-369 22,-363 28,-363 28,-363 81,-363 81,-363 87,-363 93,-369 93,-375 93,-375 93,-387 93,-387 93,-393 87,-399 81,-399"></path>
<text text-anchor="middle" x="54.5" y="-377.3" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">web client</text>
</g>
<!-- client2&#45;&gt;web -->
<g id="edge2" class="edge">
<title>client2-&gt;web</title>
<path fill="none" stroke="#000000" d="M93.0585,-381C101.3728,-381 110.225,-381 118.7375,-381"></path>
<polygon fill="#000000" stroke="#000000" points="118.8933,-384.5001 128.8932,-381 118.8932,-377.5001 118.8933,-384.5001"></polygon>
</g>
<!-- client3 -->
<g id="node4" class="node">
<title>client3</title>
<path fill="#ffffff" stroke="#ffffff" d="M81,-345C81,-345 28,-345 28,-345 22,-345 16,-339 16,-333 16,-333 16,-321 16,-321 16,-315 22,-309 28,-309 28,-309 81,-309 81,-309 87,-309 93,-315 93,-321 93,-321 93,-333 93,-333 93,-339 87,-345 81,-345"></path>
<text text-anchor="middle" x="54.5" y="-323.3" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">web client</text>
</g>
<!-- client3&#45;&gt;web -->
<g id="edge3" class="edge">
<title>client3-&gt;web</title>
<path fill="none" stroke="#000000" d="M90.9308,-345.1314C100.1681,-349.7288 110.1809,-354.7122 119.7213,-359.4604"></path>
<polygon fill="#000000" stroke="#000000" points="118.1707,-362.5981 128.6827,-363.9204 121.2897,-356.3314 118.1707,-362.5981"></polygon>
</g>
<!-- user -->
<g id="node6" class="node">
<title>user</title>
<path fill="#d3d3d3" stroke="#d3d3d3" d="M416,-400C416,-400 343,-400 343,-400 337,-400 331,-394 331,-388 331,-388 331,-374 331,-374 331,-368 337,-362 343,-362 343,-362 416,-362 416,-362 422,-362 428,-368 428,-374 428,-374 428,-388 428,-388 428,-394 422,-400 416,-400"></path>
<text text-anchor="middle" x="379.5" y="-384.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">user</text>
<text text-anchor="middle" x="379.5" y="-369.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">management</text>
</g>
<!-- transfer&#45;&gt;user -->
<g id="edge4" class="edge">
<title>transfer-&gt;user</title>
<path fill="none" stroke="#000000" d="M295.256,-381C303.131,-381 311.8452,-381 320.5947,-381"></path>
<polygon fill="#000000" stroke="#000000" points="320.8341,-384.5001 330.8341,-381 320.834,-377.5001 320.8341,-384.5001"></polygon>
</g>
<!-- content -->
<g id="node8" class="node">
<title>content</title>
<path fill="#d3d3d3" stroke="#d3d3d3" d="M401.5,-145C401.5,-145 357.5,-145 357.5,-145 351.5,-145 345.5,-139 345.5,-133 345.5,-133 345.5,-119 345.5,-119 345.5,-113 351.5,-107 357.5,-107 357.5,-107 401.5,-107 401.5,-107 407.5,-107 413.5,-113 413.5,-119 413.5,-119 413.5,-133 413.5,-133 413.5,-139 407.5,-145 401.5,-145"></path>
<text text-anchor="middle" x="379.5" y="-129.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">content</text>
<text text-anchor="middle" x="379.5" y="-114.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">relations</text>
</g>
<!-- transfer&#45;&gt;content -->
<g id="edge6" class="edge">
<title>transfer-&gt;content</title>
<path fill="none" stroke="#000000" d="M266.2508,-361.9468C271.3492,-324.6226 286.317,-240.2681 323,-180 329.2203,-169.7805 337.8581,-160.1948 346.5103,-152.0186"></path>
<polygon fill="#000000" stroke="#000000" points="348.9728,-154.511 354.0571,-145.2158 344.2859,-149.3116 348.9728,-154.511"></polygon>
</g>
<!-- lms -->
<g id="node9" class="node">
<title>lms</title>
<path fill="#d3d3d3" stroke="#d3d3d3" d="M416,-230C416,-230 343,-230 343,-230 337,-230 331,-224 331,-218 331,-218 331,-204 331,-204 331,-198 337,-192 343,-192 343,-192 416,-192 416,-192 422,-192 428,-198 428,-204 428,-204 428,-218 428,-218 428,-224 422,-230 416,-230"></path>
<text text-anchor="middle" x="379.5" y="-214.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">lms</text>
<text text-anchor="middle" x="379.5" y="-199.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">management</text>
</g>
<!-- transfer&#45;&gt;lms -->
<g id="edge7" class="edge">
<title>transfer-&gt;lms</title>
<path fill="none" stroke="#000000" d="M271.3994,-361.8019C281.151,-337.8313 299.8146,-296.1879 323,-265 330.3255,-255.1461 339.5319,-245.5112 348.374,-237.1718"></path>
<polygon fill="#000000" stroke="#000000" points="350.9763,-239.5349 355.9943,-230.2037 346.2525,-234.369 350.9763,-239.5349"></polygon>
</g>
<!-- forum -->
<g id="node10" class="node">
<title>forum</title>
<path fill="#d3d3d3" stroke="#d3d3d3" d="M416,-315C416,-315 343,-315 343,-315 337,-315 331,-309 331,-303 331,-303 331,-289 331,-289 331,-283 337,-277 343,-277 343,-277 416,-277 416,-277 422,-277 428,-283 428,-289 428,-289 428,-303 428,-303 428,-309 422,-315 416,-315"></path>
<text text-anchor="middle" x="379.5" y="-299.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">forum</text>
<text text-anchor="middle" x="379.5" y="-284.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">management</text>
</g>
<!-- transfer&#45;&gt;forum -->
<g id="edge8" class="edge">
<title>transfer-&gt;forum</title>
<path fill="none" stroke="#000000" d="M289.9205,-361.9243C306.2674,-349.8941 327.5626,-334.2223 345.2884,-321.1774"></path>
<polygon fill="#000000" stroke="#000000" points="347.6865,-323.7582 353.6661,-315.012 343.5374,-318.1203 347.6865,-323.7582"></polygon>
</g>
<!-- role -->
<g id="node7" class="node">
<title>role</title>
<path fill="#d3d3d3" stroke="#d3d3d3" d="M564,-400C564,-400 491,-400 491,-400 485,-400 479,-394 479,-388 479,-388 479,-374 479,-374 479,-368 485,-362 491,-362 491,-362 564,-362 564,-362 570,-362 576,-368 576,-374 576,-374 576,-388 576,-388 576,-394 570,-400 564,-400"></path>
<text text-anchor="middle" x="527.5" y="-384.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">role</text>
<text text-anchor="middle" x="527.5" y="-369.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">management</text>
</g>
<!-- user&#45;&gt;role -->
<g id="edge5" class="edge">
<title>user-&gt;role</title>
<path fill="none" stroke="#000000" d="M428.3709,-381C441.3202,-381 455.4345,-381 468.8454,-381"></path>
<polygon fill="#000000" stroke="#000000" points="468.9328,-384.5001 478.9328,-381 468.9328,-377.5001 468.9328,-384.5001"></polygon>
</g>
<!-- bl -->
<g id="node11" class="node">
<title>bl</title>
<path fill="#ffffff" stroke="#ffffff" d="M579,-75C579,-75 476,-75 476,-75 470,-75 464,-69 464,-63 464,-63 464,-51 464,-51 464,-45 470,-39 476,-39 476,-39 579,-39 579,-39 585,-39 591,-45 591,-51 591,-51 591,-63 591,-63 591,-69 585,-75 579,-75"></path>
<text text-anchor="middle" x="527.5" y="-53.3" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">database backend</text>
</g>
<!-- content&#45;&gt;bl -->
<g id="edge10" class="edge">
<title>content-&gt;bl</title>
<path fill="none" stroke="#000000" d="M413.8262,-109.9966C433.3149,-100.9106 458.0159,-89.3946 479.4101,-79.4203"></path>
<polygon fill="#000000" stroke="#000000" points="481.0786,-82.5041 488.6631,-75.1064 478.1207,-76.1598 481.0786,-82.5041"></polygon>
</g>
<!-- lms&#45;&gt;bl -->
<g id="edge11" class="edge">
<title>lms-&gt;bl</title>
<path fill="none" stroke="#000000" d="M419.5366,-191.8828C425.3376,-188.3191 431.022,-184.3354 436,-180 468.1366,-152.0115 495.8683,-110.9155 512.1331,-84.0583"></path>
<polygon fill="#000000" stroke="#000000" points="515.2987,-85.5824 517.3964,-75.1972 509.2803,-82.0075 515.2987,-85.5824"></polygon>
</g>
<!-- forum&#45;&gt;bl -->
<g id="edge12" class="edge">
<title>forum-&gt;bl</title>
<path fill="none" stroke="#000000" d="M421.8951,-276.8769C427.045,-273.4095 431.9185,-269.4547 436,-265 484.8719,-211.6587 510.6782,-128.007 521.3865,-84.8401"></path>
<polygon fill="#000000" stroke="#000000" points="524.8112,-85.5675 523.7318,-75.0278 518.0029,-83.9402 524.8112,-85.5675"></polygon>
</g>
</g>
</svg>
</div>
<p>You put your request at the <code>counter</code> and behind the <code>counter</code> the magic happens. The worker behind the <code>counter</code> must not know how a burger is made, and how many fries must be in a fryer. He sees the current orders on a screen, and put the meals together, when the separate parts are ready. When the order is ready, the customer can be served.</p>
<!--more-->
<h1 id="architectural-overview">Architectural overview</h1>
<p>As you can see the database take a place in the middle.</p>
<p>As mentioned in the <a href="../posts/2017-08-07-database-architecture-part3.html">database architecture series</a> the <code>web backend</code> can put a request in the database <code>transfer</code> table. This is the only table, which can be accessed by the <code>web backend</code>. After a request is processed, the result is put back into the <code>transfer</code> entity. The database sends a <a href="https://www.postgresql.org/docs/current/static/sql-notify.html">notification</a> to the <code>web backend</code>, which can pull the response from the database. This represents a very thin interface to database. This approach leads to less security issues, because more database related functions are hidden from the <code>web backend</code>.</p>
<h1 id="the-database">The database</h1>
<p>Every application’s heart is it’s database. <code>rasmus</code> is no exception. An <code>rasmus</code> application has it’s own schema within the database. The schemes look as following.</p>
<h2 id="the-core">The core</h2>
<p>The different <code>rasmus</code> applications share a <code>core</code>. Here you can find functions, used across all applications, like user and role management.</p>
<p>First start with a simple user / role management approach.</p>
<pre><code>CREATE TABLE user_account(
    id UUID NOT NULL PRIMARY KEY DEFAULT gen_random_uuid(),
    first_name VARCHAR(254),
    last_name VARCHAR(254),
    email_address VARCHAR(254),
    password VARCHAR(254),
    login VARCHAR(254),
    signature VARCHAR(254)
);</code></pre>
<p>For the time being, we store the <code>password</code> with the user. This field can be moved later on, when different authorization methods will be introduced.</p>
<p>Starting with a simple role definition,</p>
<pre><code>CREATE TYPE role_level AS ENUM ('admin','user','guest');

CREATE TABLE role(
    id UUID NOT NULL PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR(254) NOT NULL,
    description VARCHAR(254),
    role_level role_level NOT NULL DEFAULT 'guest'
);</code></pre>
<p><code>user</code>s can have several roles.</p>
<pre><code>CREATE TABLE user_in_role(
    id_user_account UUID NOT NULL REFERENCES user_account(id),
    id_role UUID NOT NULL REFERENCES role(id),
    PRIMARY KEY(id_user_account, id_role)
);</code></pre>
<p>Every part of an <code>rasmus</code> application can be associated with a <code>privilege</code></p>
<pre><code>CREATE TABLE privilege(
    id UUID NOT NULL PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR(80),
    description VARCHAR(254)
);</code></pre>
<p>Each <code>privilege</code> can be assigned to a <code>role</code>.</p>
<pre><code>CREATE TABLE role_privilege(
    id_role UUID NOT NULL REFERENCES role(id),
    id_privilege UUID NOT NULL REFERENCES privilege(id),
    PRIMARY KEY (id_role, id_privilege)
);</code></pre>
<p>These are the minimal relations for user and role management storage.</p>
<h2 id="transfer">transfer</h2>
<p>The <code>transfer</code> relation is located in the <code>core</code> schema. It uses the following state definitions.</p>
<pre><code>CREATE TYPE transfer_status as ENUM (
    'pending',
    'processing',
    'succeeded',
    'succeeded_with_warning',
    'error'
);</code></pre>
<p>This is not carved into stone. It will fit the first requirements to a stateful exchange between the <code>web backend</code> and the database.</p>
<p>The <code>transfer</code> relation itself looks like</p>
<pre><code>CREATE TABLE transfer(
	id UUID NOT NULL PRIMARY KEY DEFAULT gen_random_uuid(),
    status transfer_status NOT NULL DEFAULT 'pending',
    request JSONB NOT NULL,
    result JSONB
);</code></pre>
<p>Per default, every request is a <code>pending</code> request. A <code>transfer</code> entity must have at least a request body.</p>
<p>At this point conventions have to be made. A request must contain</p>
<ul>
<li>a <code>schema</code> field</li>
<li>the name of the <code>entity</code></li>
<li>the actual <code>payload</code></li>
<li>and the <code>action</code> to perform.</li>
</ul>
<p>After a request is inserted into <code>transfer</code>,</p>
<pre><code>CREATE FUNCTION transfer_trigger() RETURNS TRIGGER AS $$
BEGIN 
    PERFORM pg_notify(NEW.request-&gt;&gt;'schema',NEW.id); 
    RETURN NEW;
END
$$ LANGUAGE plpgsql;

CREATE TRIGGER transfer_before_trigger BEFORE INSERT ON transfer
    FOR EACH ROW EXECUTE PROCEDURE transfer_trigger();</code></pre>
<p>a notification is send to the <code>database backend</code>. Pattern matching is used to find the right addressee for the request. A closer look has to be made, to decide, which operation must be done inside the database, to prevent multiple round trips.</p>
<div class="overflow"><?xml version="1.0" encoding="UTF-8" standalone="no" ?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="292pt" height="46pt" viewBox="0.00 0.00 292.00 46.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 42)">
<title>%3</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-42 288,-42 288,4 -4,4"></polygon>
<!-- web -->
<g id="node1" class="node">
<title>web</title>
<path fill="#d3d3d3" stroke="#d3d3d3" d="M56,-38C56,-38 12,-38 12,-38 6,-38 0,-32 0,-26 0,-26 0,-12 0,-12 0,-6 6,0 12,0 12,0 56,0 56,0 62,0 68,-6 68,-12 68,-12 68,-26 68,-26 68,-32 62,-38 56,-38"></path>
<text text-anchor="middle" x="34" y="-22.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">web</text>
<text text-anchor="middle" x="34" y="-7.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">backend</text>
</g>
<!-- database -->
<g id="node2" class="node">
<title>database</title>
<path fill="#d3d3d3" stroke="#d3d3d3" d="M164,-37C164,-37 116,-37 116,-37 110,-37 104,-31 104,-25 104,-25 104,-13 104,-13 104,-7 110,-1 116,-1 116,-1 164,-1 164,-1 170,-1 176,-7 176,-13 176,-13 176,-25 176,-25 176,-31 170,-37 164,-37"></path>
<text text-anchor="middle" x="140" y="-15.3" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">database</text>
</g>
<!-- web&#45;&gt;database -->
<g id="edge1" class="edge">
<title>web-&gt;database</title>
<path fill="none" stroke="#000000" d="M68.1225,-12.6459C76.2117,-12.2925 84.9756,-12.1757 93.5109,-12.2955"></path>
<polygon fill="#000000" stroke="#000000" points="93.6611,-15.8004 103.7478,-12.5589 93.8412,-8.8027 93.6611,-15.8004"></polygon>
</g>
<!-- database&#45;&gt;web -->
<g id="edge4" class="edge">
<title>database-&gt;web</title>
<path fill="none" stroke="#000000" d="M103.7478,-25.4411C95.548,-25.7533 86.752,-25.8288 78.2634,-25.6678"></path>
<polygon fill="#000000" stroke="#000000" points="78.226,-22.1651 68.1225,-25.3541 78.0095,-29.1617 78.226,-22.1651"></polygon>
</g>
<!-- bl -->
<g id="node3" class="node">
<title>bl</title>
<path fill="#d3d3d3" stroke="#d3d3d3" d="M272,-38C272,-38 224,-38 224,-38 218,-38 212,-32 212,-26 212,-26 212,-12 212,-12 212,-6 218,0 224,0 224,0 272,0 272,0 278,0 284,-6 284,-12 284,-12 284,-26 284,-26 284,-32 278,-38 272,-38"></path>
<text text-anchor="middle" x="248" y="-22.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">database</text>
<text text-anchor="middle" x="248" y="-7.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">backend</text>
</g>
<!-- database&#45;&gt;bl -->
<g id="edge2" class="edge">
<title>database-&gt;bl</title>
<path fill="none" stroke="#000000" d="M176.2629,-12.5846C184.3661,-12.2682 193.0689,-12.1762 201.5209,-12.3085"></path>
<polygon fill="#000000" stroke="#000000" points="201.5584,-15.8107 211.649,-12.5812 201.7468,-8.8132 201.5584,-15.8107"></polygon>
</g>
<!-- bl&#45;&gt;database -->
<g id="edge3" class="edge">
<title>bl-&gt;database</title>
<path fill="none" stroke="#000000" d="M211.649,-25.4188C203.5414,-25.7336 194.8374,-25.824 186.3872,-25.69"></path>
<polygon fill="#000000" stroke="#000000" points="186.3542,-22.1879 176.2629,-25.4154 186.1643,-29.1854 186.3542,-22.1879"></polygon>
</g>
</g>
</svg>
</div>
<p>As said before, the business logic is completely separated from the <code>web backend</code>.</p>
<h2 id="cms">cms</h2>
<p>A cms starts with an <code>article</code>.</p>
<pre><code>CREATE TABLE article(
    id UUID NOT NULL PRIMARY KEY DEFAULT gen_random_uuid(),
    id_author UUID NOT NULL REFERENCES core.user_account(id),
    title VARCHAR(254),
    raw text,
    html text,
    is_visible boolean NOT NULL DEFAULT FALSE,
    is_draft boolean NOT NULL DEFAULT TRUE
);</code></pre>
<p>The <code>author</code> lives in the <code>core</code> namespace, and can be used inside the <code>cms</code> schema. The <code>raw</code> text is markdown based, the <code>html</code> is the generated result. A new <code>article</code> is per default invisible and in draft mode.</p>
<p>Before uploading <code>attachment</code>s to the database, the <code>file_type</code> has to be set.</p>
<pre><code>CREATE TYPE file_type AS ENUM (
    'binary',
    'jpeg',
    'png',
    'mp3',
    'mp4',
    'mkv'
);

CREATE TABLE attachment(
    id UUID NOT NULL PRIMARY KEY DEFAULT gen_random_uuid(),
    raw bytea NOT NULL,
    file_type file_type NOT NULL DEFAULT 'binary'
);</code></pre>
<p>As for now, the binary content is stored within the database.</p>
<p>Every <code>article</code> can have multiple attachments.</p>
<pre><code>CREATE TABLE article_attachment(
    id_article UUID NOT NULL REFERENCES article(id),
    id_attachment UUID NOT NULL REFERENCES attachment(id),
    PRIMARY KEY(id_article, id_attachment)
);</code></pre>
<p>The <code>attachment</code>s can be addressed within the <code>article</code>s markdown content.</p>
<p>The <code>cms</code> provides a tree of <code>category</code>s.</p>
<pre><code>CREATE TABLE category(
    id UUID NOT NULL PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR(254) NOT NULL,
    description VARCHAR(512),
    icon VARCHAR(1), -- font awesome
    is_active BOOLEAN NOT NULL DEFAULT false,
    is_visible BOOLEAN NOT NULL DEFAULT false,
    LNUM INTEGER NOT NULL,
    RNUM INTEGER NOT NULL
);</code></pre>
<p>The tree is described as a <a href="https://en.wikipedia.org/wiki/Nested_set_model">nested set</a>.</p>
<p>An <code>article</code> can be assigned to multiple <code>categories</code>.</p>
<pre><code>CREATE TABLE article_in_category(
    id_article UUID NOT NULL REFERENCES article(id),
    id_category UUID NOT NULL REFERENCES category(id),
    PRIMARY KEY(id_article, id_category)
);</code></pre>
<h1 id="backend">backend</h1>
<p>Having set up the database, it comes for choosing the technology for the backend. There are several possibilities choosing the ‘right’ backend technology.</p>
<p>This will be covered with the next article.</p>
<p>Fell free to browse through the <a href="https://github.com/enter-haken/rasmus">sources</a>.</p>

        </section>

        <section id="footer"> 
            created by Jan Frederik Hake | 
            <a href="https://enter-haken.github.io/atom.xml">atom feed</a> | 
            generated by <a href="http://jaspervdj.be/hakyll">Hakyll</a> | 
            <a href="https://github.com/enter-haken/blog">blog source</a> |
            the source code on this site is covered by a <a href="../license.html">MIT license</a> | 
            <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">
              <img alt="Creative Commons Lizenzvertrag" style="border-width:0;vertical-align:middle;" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" />
            </a>
        </section>
    </body>
</html>
